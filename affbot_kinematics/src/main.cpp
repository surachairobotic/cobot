//https://github.com/ros-planning/moveit_pr2/blob/groovy-devel/pr2_moveit_plugins/pr2_arm_kinematics/src/main.cpp

#include "affbot_kinematics.h"

void test_fk(affbot_kinematics::AffbotKinematics &affbot_kinematics);
void test_ik(affbot_kinematics::AffbotKinematics &affbot_kinematics);

const double pp[][12] =
    // q5
{
{0.1,-0.205562741263,0.656808135822,0.975170327201,0.197676811654,-0.0198338380773,0.097843395012,0,0,0,-0.2,0.4},
{-0.0850905238015,-0.0876286958356,0.364430767897,0.177928416381,0.763800585932,0.529034506725,0.324149092654,-0.778588391683,0.441554826773,0.718201761113,0.178859595084,-2.82074364296},
{0.201789962673,-0.297812719666,0.545815363817,0.682451777656,0.519451515639,0.20029812099,-0.473614143372,0.250499519939,0.387052786415,-0.0625442122937,0.755704295079,1.05070468918},
{0.165524683842,0.449455654019,0.292272884196,0.803445315905,0.342514714934,-0.270266245457,0.405111652474,2.95623986944,0.722960080695,0.455437078038,-0.161116764926,-2.15028479232},
{0.00687392515253,0.580113014093,0.348257150832,-0.383075114183,0.850239501586,-0.351385274832,-0.0829134215162,-2.95000474039,0.785044340019,-0.0631823710285,0.0168929839707,0.65503393826},
{-0.521571170185,0.186338956476,0.294287207305,-0.217202135016,0.846731646968,-0.184250522013,0.449355645014,-1.70881754592,1.21188088484,-0.816040782041,0.618403295559,-0.930567044167},
{-0.347282816533,-0.0465998408716,0.632678332984,0.862153846487,0.0838019575705,0.487643485267,-0.10895782749,-1.25407331076,0.50987909145,-0.554312096783,1.09086361215,1.44786592529},
{0.0448567289462,-0.169490233975,0.616137760126,0.288711636442,0.886201119786,-0.360028656735,0.0408966087001,-0.201834533954,-0.101121817466,0.253110563017,-0.893551860535,2.71354247228},
{0.162936627345,0.510624498578,0.739627576682,-0.251060753594,0.885379353438,-0.355888505836,-0.162527751246,2.9895057055,0.397774336799,-0.759032287618,1.16522395122,0.704706009993},
{-0.130265843085,0.539058068392,0.436211874996,0.477160043166,0.878731930074,0.0067827860797,-0.0101233437255,-2.65857362563,0.62083651267,-0.114841924087,-0.530366344788,-1.47794025392},
{0.377937347959,0.168758278568,0.682391115646,-0.144241374669,0.954352383526,-0.024161911808,-0.260426872481,1.81331483833,0.00320909041159,-0.0776526366704,0.603689358396,1.62828830354},
{0.515960066454,0.15490465594,0.650614547167,0.656779208968,0.534191815767,0.453304687722,0.278917612788,1.7020326894,0.238523957029,-0.204603275906,-1.15641089985,-0.336375187862},
{0.249033451262,0.403380083849,0.268127458339,0.120944715226,-0.326179217472,0.645280243252,0.680141824634,2.68497486552,0.868754320863,0.531672494622,1.03054797605,1.1667709112},
{0.301090880138,0.195619533992,0.642020173645,-0.579859474908,0.621963237378,-0.158787815165,0.501708232408,2.01465586705,-0.257682038045,0.312813043122,-1.16346788161,2.62769524559},
{0.429380425173,0.311891479588,0.303456857391,-0.0358920012598,-0.648973210639,0.445824720099,0.615455810816,2.14244936008,0.78730573304,0.313254108188,0.625956125954,0.888644206693},
{0.343434354824,-0.0764786975817,0.400974572463,0.794138763373,-0.124656309564,-0.529892082668,-0.27021992843,0.943518318223,0.393957569537,0.558468850902,0.321643608054,-1.25491818414},
{-0.307723275123,0.504300326887,0.564516818234,0.729885786186,-0.54821847354,0.404492992684,0.0557553877503,-2.35197918419,0.83540731639,-0.937518144503,0.943331302365,1.06356750336},
{0.247900058094,-0.321349156131,0.741850143613,-0.250239542778,0.965507477559,-0.0716872856987,0.00603449066551,0.33757915359,0.435517279077,-0.856690919204,0.277167594794,-2.97197348259},
{-0.0515287703734,-0.375113068199,0.620426127645,-0.569364695158,0.785133104619,-0.144485883511,-0.196249029057,-0.308733866837,0.482296164419,-0.503889142786,-0.470765814332,-1.57800333113},
{0.332660581457,0.699032900176,0.323935766278,0.854534431583,0.489439093383,-0.135152363465,0.109334888109,2.77113160744,1.16184626083,-0.846425164468,0.034033935344,-1.73084027892},
{0.30602406696,0.549881004326,0.135998249024,-0.675526044092,0.724520316707,-0.0521563106128,-0.126548779908,2.71214525711,1.19023812823,-0.0714127307815,-0.844212533561,1.93028277244},
{0.339915820065,0.439175877106,0.19041772504,0.449049346675,-0.420813062703,0.107887089778,0.780788976849,2.52595128259,1.08709252719,0.184234482502,0.544454655543,2.25133617479},
{0.534294215767,-0.0148520972606,0.491139191333,0.985248437111,-0.0760499318428,0.150785155722,0.0276724023206,1.31225813808,0.438186141723,0.00496322846921,-0.750969978548,-1.46632980062},
{0.458326153873,-0.449494778495,0.300671273548,0.922469353817,-0.384723925385,-0.0266275961775,-0.0181318401531,0.57785085583,1.20860014539,-0.878052384778,-0.266107037177,-1.36810118593},
{-0.378935173847,0.0654611872064,0.286987026347,0.914422079404,0.249979334526,0.3123186224,0.0616414723236,-1.49880511473,0.873498750109,0.00951944126784,-0.235055030984,2.03251315291},
{0.374571385348,0.175637854267,0.773713855746,-0.226498458183,0.936775915214,-0.00842129217708,-0.266605354324,1.83960510971,0.0543470142556,-0.444395822287,0.930063099029,1.7764518913},
{-0.179280979805,0.504562904691,0.158691697673,0.705282751227,-0.621854935295,0.330320061111,0.0822273524979,-2.5373877049,1.15988980642,-0.0852655987175,-0.379938042886,1.0921520961},
{0.330660148235,-0.00779123075952,0.763171004419,-0.475228953553,0.790702158295,0.320160531335,-0.21551049336,1.13363589968,-0.0219156567614,-0.313244047516,1.12760677848,3.09029720221},
{-0.0706754454813,0.516902724363,0.506692899094,0.785956271562,-0.264727582482,0.36567110829,0.422465012548,-2.75301849118,0.520599239293,-0.130628645688,0.79576447779,2.1032438674},
{0.312274656829,0.0192797383492,0.687526731773,0.689713396597,-0.685237631371,0.213758575559,-0.0951424746566,1.20741925951,-0.209901935433,0.0862857438839,-0.348714428722,-2.77170517346},
{0.196968379399,-0.238763820542,0.59712086358,-0.555721920425,0.830437538971,-0.0374412117936,-0.0120331495186,0.278787330099,0.138751011141,0.0468851918149,-0.264311206663,-2.24088262995},
{-0.122237486412,0.014130818617,0.66927567966,0.102117980701,0.981498698256,-0.0736951896122,-0.144226358087,-1.20208203051,-0.176347939915,0.117112330033,-0.266124892293,-2.14685044435},
{-0.214139667956,0.356186727907,0.14147321548,0.287349548274,0.905560809787,-0.114845351643,0.290173055419,-2.25492843268,1.1224284692,0.241906485013,-0.729585494755,-1.50119817977},
{0.128620339939,-0.295744053349,0.763539662489,0.883020642292,0.173025416566,-0.0527910200356,0.433070269947,0.0721946387111,0.23961363605,-0.608092008346,-0.534433358958,0.314796582513},
{0.336737514381,0.388907464598,0.42557866786,0.0413507629599,0.938159208979,-0.275202448662,-0.205939372779,2.45511992198,0.433929138705,0.296764491501,-0.0289305225594,0.598376775498},
{0.514407221782,0.289098308903,0.313332732881,-0.16597275042,-0.600071798511,0.502886077397,0.599560235432,1.99888554334,0.855851895229,0.068338605578,0.87327563007,0.603022902695},
{0.566607704404,0.442559125375,0.391740472944,0.808938721872,-0.244974271055,-0.32063628098,0.427548975085,2.20407474207,0.952602744365,-0.568820574277,0.743862846631,-2.79218454314},
{0.609639090172,-0.0596888761083,0.639295976766,0.938160275354,0.269913030316,-0.180893988162,-0.119497359222,1.26714894113,0.690228355751,-0.932503542467,0.679345867347,-0.706871350313},
{-0.128761963683,-0.0191260606959,0.469223536963,0.51583657894,-0.00102024396692,0.75905145297,-0.397180657477,-1.09069280649,0.198751035925,0.625692826889,1.23317865417,1.08673712488},
{-0.183977231662,0.286358773816,0.219757824199,0.299654496034,0.043754285794,0.712882220211,0.632528011702,-2.15154951881,1.01167655992,0.503294578383,1.01129582011,2.441531806},
{-0.0893695781338,0.257705007855,0.843730727032,0.140556156062,0.977384542224,0.0827974325778,-0.13456600155,-2.26521360239,0.00597958760829,-0.675104395289,0.351798738324,-1.16203747356},
{0.562884667648,-0.0868578808183,0.581609189413,-0.0478393908099,0.996229503645,0.0302802340981,-0.0657364143951,1.18712045586,0.534687189509,-0.470959474992,0.0811493441311,2.05043938091},
{0.316992338801,-0.101022461272,0.852278195455,-0.205198404057,0.867766717053,-0.375760937436,0.252345512431,0.823583688644,0.0954216535291,-0.765758093585,-0.269090235943,2.78241288779},
{-0.199859653867,-0.125015995439,0.858179262817,0.817596858106,-0.0423246966621,-0.440865201593,0.367942755999,-0.927036469749,0.329864319206,-1.08231556755,-0.470883687884,0.823594414955},
{0.17198307145,0.619386473695,0.408934528317,0.23977033395,0.719864549039,-0.640414816252,0.119054949999,3.00387741837,0.811659529679,-0.301882593545,0.909045502112,-0.505324461977},
{-0.410210122613,0.221045145772,0.216427282887,-0.325830617852,0.604860549603,-0.482964974696,0.542883926103,-1.80373536979,1.14672545008,-0.252170704228,0.73222707097,-0.349624746158},
{0.36152675166,0.2038016494,0.619802185173,0.369316757243,0.77543479195,-0.375272339819,-0.348535058809,1.94863299181,0.0259388843008,0.144898883186,0.904553595851,0.303990695532},
{-0.0636092180172,0.362710084982,0.55929072471,0.936726608468,0.349542574929,0.00378359973776,0.0186797663994,-2.58459508976,0.0659720128396,0.260142657482,-0.287994161828,-2.9842889846},
{-0.236917376114,0.353749492807,0.699694447439,0.925886946935,-0.324416247256,0.184476316404,0.0587873175001,-2.2163107131,0.357332307054,-0.581237991532,0.613600406342,1.54227643965},
{0.0702486547801,-0.269265587367,0.592269231134,-0.755661403295,0.349053553829,0.191243924782,0.520156919942,-0.0803953042703,0.262949470923,-0.0362408516852,0.948094116621,-0.785045822479},
{0.161471334625,-0.107270196493,0.417131544963,-0.0141100005569,0.616013834314,0.760030629415,-0.206594545353,0.288312419117,0.245094519395,0.816242998872,0.752500185701,2.8990828867},
{-0.209655385213,0.0577111707022,0.464039748873,0.867320293437,-0.469055536617,-0.134439333948,0.0983284172976,-1.43506857939,0.174167419301,0.501870934304,-1.01071924175,0.443548132016},
{-0.0782737996153,0.313850202167,0.665864841797,0.904409109468,0.137929567062,0.2088232187,0.345561080814,-2.44667420162,-0.00225435281782,0.000631816212408,0.832861725874,2.74935778221},
{0.26119723781,-0.140070694309,0.172379927675,0.937188554039,-0.11151321525,-0.215378399487,-0.250708121205,0.591311917295,1.02407060879,0.663843678902,-1.01420869093,-0.828172208333},
{-0.142352660017,-0.291438914414,0.450966127753,0.846099203807,0.495186733377,0.174322495963,-0.0922924905145,-0.554369055009,0.553177273596,-0.0380012040271,-0.118078899949,1.61338830157},
{-0.410129275718,0.382364187603,0.518794716503,0.443522843045,0.892050140698,-0.00382977518454,0.0867142837197,-2.07633416038,0.804840949049,-0.754260920202,0.123236324047,-1.98806062965},
{0.680234805723,0.13055158698,0.534566729011,0.898250236114,-0.336076031859,-0.259653288963,0.113046820659,1.62340158168,0.834155199246,-0.851169638299,0.591262176039,-2.33944370818},
{-0.0706891998919,0.648448897598,0.489193927712,0.710601389528,-0.699121134087,0.0698275730765,0.0374087571524,-2.83987277822,0.786045520562,-0.618370792508,-0.00907490876396,1.28536334686},
{0.236202625015,-0.06788464797,0.453533639113,-0.472292700314,0.789794689079,0.387386943587,-0.0556355126842,0.681585440355,0.056897489888,0.721520930479,0.0258032188275,-2.74529130326},
{0.702717038615,0.207708692562,0.452970526507,0.283943150517,0.918846766283,-0.125706006707,-0.243505456291,1.74763485544,0.966062225394,-0.849457358472,0.438573978539,0.794532880457},
{-0.450628316388,0.235485811688,0.686184356751,-0.581088413402,-0.513013149501,0.359997938853,0.519187103337,-1.81206026233,0.69852329219,-1.04283506211,-1.02339895908,-3.02460898925},
{0.305864772444,-0.0994845855591,0.805359299655,0.419301722894,0.874579582103,0.077200732973,-0.230947324244,0.801136834126,0.0970214736983,-0.61167446429,1.00661717636,1.44633882134},
{-0.108172214691,-0.025424622571,0.85973093187,-0.397803628255,0.893292135598,0.0257341812483,0.207651597014,-1.02853757625,0.0827342699697,-0.823235463366,1.16209685042,-1.2751394417},
{-0.0064301443726,0.381137537389,0.320957988151,-0.138361808682,0.806607266938,-0.564104435281,0.109667282802,-2.77969608952,0.604261393656,0.627815448635,-0.0076855073309,-0.02213220098},
{-0.0737007157422,0.663207929741,0.671696252812,-0.694192388253,-0.116092953976,0.0945214698897,0.704049036544,-2.8424353822,0.770519827706,-1.11095108073,-1.23960391344,-3.10934759526},
{-0.176364846598,0.00676101244776,0.350777140754,-0.237469930228,0.837670097351,0.0241618546457,0.491256597942,-1.2454114024,0.490986126562,0.642494579118,-0.105053216119,-1.34369975155},
{-0.0690783401388,-0.293837228177,0.302496871904,0.847842792557,0.351580187313,0.284355869477,-0.276939904116,-0.405515755805,0.776163610927,0.197104866409,-0.15692769825,1.19170348111},
{0.242948689964,-0.12237675868,0.257583127934,-0.308077453606,-0.0840218931483,0.284623630931,0.903890476091,0.571312667725,0.897608573009,0.778146771491,0.815793372758,-0.0388039201555},
{0.497453873268,-0.429846174691,0.492444235584,0.696900176361,-0.53385758432,0.461078315398,0.129356139868,0.643584741105,1.01130692858,-1.04815046205,-0.961913804696,-1.95096813535},
{0.116485885499,-0.55179981092,0.564016359724,0.448974920419,0.695747603464,-0.463263650375,0.315822075464,0.025287474883,0.990331860455,-1.2285705345,-0.952163567335,1.97015877098},
{0.224082728086,-0.0918272735487,0.280881749818,-0.194154126056,0.16841322347,0.928201616407,0.269040741888,0.574154887347,0.83931380157,0.91688914605,0.865516799657,-2.00319667235},
{0.330381236481,0.187199694395,0.574079670199,0.947368912891,-0.319528523419,-0.0153384141957,0.0125856529545,1.93263345878,-0.104415248568,0.374395934266,-0.230296065047,-2.58323001621},
{0.00203554612583,-0.0888354999049,0.514440722015,-0.173056558795,0.97153968255,0.128289106659,0.0985087701769,-0.478560042399,-0.108109178836,0.597170027219,-0.164139553197,-2.3104781309},
{-0.205880856189,0.317408108409,0.801704585315,0.038419047798,0.98676637022,-0.0861986920321,0.131855575764,-2.18870782472,0.344688251137,-0.937435625283,0.909127829627,-1.03071409772},
{-0.0619665774738,0.277314108788,0.150279953028,0.257874380195,0.829002616819,-0.250449005812,0.428404902907,-2.40139917313,1.15197424373,0.762720756528,-0.876166886438,-1.34334898656},
{-0.214951889902,-0.230330962823,0.8172834328,-0.515199056324,-0.523970067342,0.678171346222,-0.0104367646781,-0.761569602022,0.499858286649,-1.16102660329,-0.829593194502,2.34924634326},
{0.00164379922316,0.732639681283,0.418279627601,0.219673145042,0.972668397357,0.0699668434288,-0.0276502974965,-2.98735786129,1.01623796953,-0.8524584706,-0.314386386286,-0.598473616532},
{0.455504288556,0.214624391268,0.80218673331,0.755369518072,0.443970480715,0.470421987752,0.104929771088,1.88269981326,0.216007080145,-0.709922600441,-0.511916353394,-0.819968884121},
{-0.2186228941,0.674395832592,0.502729125515,0.850691332719,0.0760814464243,-0.210783908733,-0.475506060704,-2.63514080369,0.979504555032,-1.0073599543,-1.06615237664,2.81353586509},
{0.458574053973,0.697008763184,0.396014646318,0.867633043885,-0.154823409496,0.168339450193,-0.44147983254,2.60071905668,1.20486248655,-1.15195272219,-1.03712751239,-2.95388866182},
{-0.0934552590836,-0.193896002024,0.429790593315,0.888700338632,0.23864007,0.292688219364,-0.259992752497,-0.582148787839,0.391802583215,0.359288508877,0.0534044857444,1.10682568293},
{-0.247463470988,0.353217189702,0.114046747208,0.978500933595,0.118961984355,0.123185449689,0.114931780705,-2.20056413794,1.19059202695,0.152214762327,-1.00424122583,2.44252817004},
{0.370548916219,-0.0729800895978,0.763601881007,-0.294235625959,0.946419692434,0.101755320166,-0.0857963694257,1.0019322216,0.123221844277,-0.496470562192,0.640237638547,2.7425014838},
{0.155122854656,-0.121119728031,0.581805061899,-0.379769990176,0.854972801134,-0.347949137924,-0.0610545764165,0.244309965669,-0.205435887232,0.451313849521,-0.967995954631,-2.54987968791},
{-0.0868172900511,0.443647536528,0.356731150722,0.280369497007,0.867769519189,-0.282788124728,0.297321178572,-2.64365278492,0.608028891629,0.304182745232,-0.0665843861792,-1.12295051629},
{0.139235249314,-0.197818831705,0.176976960584,-0.443052532654,0.0412305537003,0.198737599428,0.873216961198,0.13098767303,1.12233568999,0.574590441014,0.522392015368,-0.316573551529},
{-0.172568037525,-0.195060887981,0.494146424337,0.789271114769,0.572823372439,-0.216902145491,0.0433353280792,-0.745792907867,0.321998616815,0.179740376875,-0.94780561325,2.00140851231},
{0.0119739875307,0.518903664147,0.183772615708,0.638776109754,-0.184733767107,0.350607063127,0.659479494893,-2.93447187136,1.10498607827,0.131337837519,0.450408993222,2.37143404174},
{-0.13494815564,0.344112558224,0.276369994432,0.780612636582,-0.304113024087,0.495638763173,0.229131832424,-2.37532209687,0.759925627683,0.510091936717,-0.114758620065,1.63233481152},
{-0.319330064319,0.17301489024,0.829130576747,-0.196795764839,-0.770756216478,0.0469721391104,0.604152215794,-1.74319065237,0.424359163341,-1.10075491628,-0.625587383397,-1.89837615911},
{0.0959279536496,0.514723684853,0.14690501733,-0.452103678063,0.843747601566,-0.256325875418,-0.13412417651,-3.13177427174,1.11163490076,0.217888269216,-0.74254028858,0.973976837791},
{-0.305117509192,-0.0157941669275,0.456631623271,0.998029711749,0.0218726762606,0.0568833072503,-0.0149187752892,-1.29239099232,0.443333724581,0.123711852878,-0.449363387847,1.33621569044},
{0.252472064661,-0.0937298279174,0.557486293105,0.301286459727,0.931525876671,-0.113522779088,0.169111173211,0.666785018346,-0.120571157377,0.453991106881,-0.743652805325,1.84917924968},
{-0.0348725817098,-0.238480410983,0.149299845609,0.47291665199,0.708155539538,0.512800451135,-0.109092939311,-0.379182362341,1.11483398288,0.355031614043,-0.36613569272,2.3431811195},
{0.554896055511,0.592559874027,0.303131721704,-0.214655738579,0.8848901699,0.22901407711,0.344158181065,2.39592615105,1.18827385261,-0.805699533879,-1.23492487448,1.22163060942},
{0.268188358346,-0.060575638093,0.243503060691,-0.209782953323,-0.72505718334,-0.30326032495,0.58164969586,0.808549603866,0.863380090241,0.853796310086,-0.286269491026,1.7697589815},
{0.5973012356,0.406582265812,0.440963323881,0.844559143146,-0.146170226928,-0.385969410231,0.34114767016,2.12325416995,0.918696528468,-0.673276347222,0.836887579813,-2.46600444229},
{-0.352744305538,0.364717527649,0.453030438676,0.106908938193,0.993583449065,0.0151148875719,-0.0336741570351,-2.09988645417,0.664461360896,-0.259498188716,-0.478801586215,-1.25608013473},
{0.494312733737,0.0628808123677,0.818575601881,-0.299071358679,0.951814729962,-0.026320024999,0.0625483695201,1.47693650982,0.432600145802,-1.15749142399,0.58906597183,2.27354325151},
{0.442516660743,0.191140596556,0.320198248881,0.953761410594,-0.185184870866,-0.212981698773,0.103366006272,1.83086118192,0.611908195031,0.482605846255,-0.616496265534,-2.21441418751},
{-0.337460048754,-0.198769753592,0.567961348788,0.354863880571,0.897479793767,-0.216899110399,-0.146821054192,-0.971595205498,0.573180435087,-0.479032995161,-0.624167937919,-2.92306732263}
};


int main(int argc, char** argv){
  ros::init(argc, argv, "affbot_kinematics");
  affbot_kinematics::AffbotKinematics affbot_kinematics;

  if( !affbot_kinematics.initialize("robot_description", "arm", "base_link", "L5", 0) ){
    ROS_ERROR("affbot_kinematics.initialize() failed");
    return 0;
  }
  if(!affbot_kinematics.isActive()){
    ROS_ERROR("affbot_kinematics could not be activated");
    return 0;
  }

  test_ik(affbot_kinematics);
  return 0;
}

void print_pose(geometry_msgs::Pose &pose){
  geometry_msgs::Point &p = pose.position;
  geometry_msgs::Quaternion &q = pose.orientation;
  ROS_INFO("pos  : %lf, %lf, %lf", p.x, p.y, p.z);
  ROS_INFO("xyzw : %lf, %lf, %lf, %lf\n", q.x, q.y, q.z, q.w);
}

bool is_same_pose(geometry_msgs::Pose &p1, geometry_msgs::Pose &p2){
  const double E = 0.0001;
  return fabs(p1.position.x-p2.position.x)<E
      && fabs(p1.position.y-p2.position.y)<E
      && fabs(p1.position.z-p2.position.z)<E
      && fabs(p1.orientation.x-p2.orientation.x)<E
      && fabs(p1.orientation.y-p2.orientation.y)<E
      && fabs(p1.orientation.z-p2.orientation.z)<E
      && fabs(p1.orientation.w-p2.orientation.w)<E;
}

void test_fk(affbot_kinematics::AffbotKinematics &affbot_kinematics){
  geometry_msgs::Pose p;
  for(int i=0;i<sizeof(pp) / (sizeof(double)*12);i++){
    p.position.x = pp[i][0];
    p.position.y = pp[i][1];
    p.position.z = pp[i][2];
    p.orientation.x = pp[i][3];
    p.orientation.y = pp[i][4];
    p.orientation.z = pp[i][5];
    p.orientation.w = pp[i][6];

    double q[5] = { pp[i][7],pp[i][8],pp[i][9],pp[i][10],pp[i][11] };

    std::vector<std::string> link_names;
    std::vector<double> joint_angles;
    std::vector<geometry_msgs::Pose> poses;

    link_names.push_back("base_link");
    link_names.push_back("L1");
    link_names.push_back("L2");
    link_names.push_back("L3");
    link_names.push_back("L4");
//    link_names.push_back("L5");
//    link_names.push_back("tool0");
    for(int i=0;i<5;i++)
      joint_angles.push_back(q[i]);
    if( !affbot_kinematics.getPositionFK(link_names, joint_angles, poses) )
      return;
//    print_pose(p);

    if( !is_same_pose(poses[0], p) ){
      ROS_WARN("wrong pose");
      return;
    }
  }
}

void test_ik(affbot_kinematics::AffbotKinematics &affbot_kinematics){

  geometry_msgs::Pose p;


//  {{-0.219422022926,0.174522287057,0.684250000004,0.18915023568,-0.68133852697,-0.339005049425,0.620544580568,-1.8,0.0,0.0,-1.57079632679,-0.8}};
  for(int i=0;i<sizeof(pp) / (sizeof(double)*12);i++){
    p.position.x = pp[i][0];
    p.position.y = pp[i][1];
    p.position.z = pp[i][2];
    p.orientation.x = pp[i][3];
    p.orientation.y = pp[i][4];
    p.orientation.z = pp[i][5];
    p.orientation.w = pp[i][6];

    double q[5] = { pp[i][7],pp[i][8],pp[i][9],pp[i][10],pp[i][11] };
    std::vector<double> seed // an initial guess solution for the inverse kinematics
        , ans;
    moveit_msgs::MoveItErrorCodes err;
    affbot_kinematics.getPositionIK( p, seed, ans, err);
    for(int i=0;i<5;i++){
      if( fabs(ans[i]-q[i]) > 0.001 ){
        ROS_WARN("err ik: %lf, %lf, %lf, %lf, %lf", ans[0], ans[1], ans[2], ans[3], ans[4]);
        ROS_WARN("err or: %lf, %lf, %lf, %lf, %lf", q[0], q[1], q[2], q[3], q[4]);
        return;
      }
    }
  }
}
